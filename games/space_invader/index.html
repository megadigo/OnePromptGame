<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Invaders</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: Arial, sans-serif;
        }
        
        #game-container {
            text-align: center;
        }
        
        canvas {
            border: 3px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            background: #000000;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas" width="1200" height="800"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        // Game state
        let gameState = 'menu';
        let lives = 3;
        let level = 1;
        let score = 0;
        let frameCount = 0;

        // Player
        const player = {
            x: 600,
            y: 750,
            width: 50,
            height: 50,
            speed: 5,
            color: '#0080FF',
            moving: { left: false, right: false }
        };

        // Invaders
        let invaders = [];
        let invadersDirection = 1;
        let invadersMoveTimer = 0;
        let invadersMoveInterval = 40;
        let invadersShootTimer = 0;
        let invadersShootInterval = 30;

        // Bullets
        let playerBullets = [];
        let enemyBullets = [];

        // Keys pressed
        const keys = {};

        // Audio (optional - will fail silently if files don't exist)
        const audio = {
            playerShoot: new Audio('assets/player_shoot.wav'),
            playerDie: new Audio('assets/player_die.wav'),
            enemyDie: new Audio('assets/enemy_die.wav')
        };

        // Mute audio errors
        Object.values(audio).forEach(sound => {
            sound.addEventListener('error', () => {});
        });

        // Initialize invaders
        function initInvaders() {
            invaders = [];
            const rows = 5;
            const columns = 10;
            const startX = 150;
            const startY = 100;
            const spacingX = 80;
            const spacingY = 60;
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < columns; col++) {
                    invaders.push({
                        x: startX + col * spacingX,
                        y: startY + row * spacingY,
                        width: 40,
                        height: 40,
                        color: '#FF0000',
                        alive: true
                    });
                }
            }
            
            invadersDirection = 1;
            invadersMoveTimer = 0;
            invadersShootTimer = 0;
            
            // Increase difficulty with level
            invadersMoveInterval = Math.max(10, 40 - (level - 1) * 5);
            invadersShootInterval = Math.max(10, 30 - (level - 1) * 5);
        }

        // Reset game
        function resetGame() {
            lives = 3;
            level = 1;
            score = 0;
            player.x = 600;
            player.y = 750;
            playerBullets = [];
            enemyBullets = [];
            initInvaders();
            gameState = 'playing';
        }

        // Next level
        function nextLevel() {
            level++;
            playerBullets = [];
            enemyBullets = [];
            initInvaders();
        }

        // Input handling
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            
            if (gameState === 'menu' && e.code === 'Space') {
                resetGame();
            } else if (gameState === 'gameOver' && e.code === 'KeyR') {
                resetGame();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        // Update player
        function updatePlayer() {
            if (keys['KeyA'] || keys['ArrowLeft']) {
                player.x = Math.max(0, player.x - player.speed);
            }
            if (keys['KeyD'] || keys['ArrowRight']) {
                player.x = Math.min(1150, player.x + player.speed);
            }
            
            // Shooting
            if (keys['Space']) {
                // Can shoot continuously (no cooldown)
                if (frameCount % 10 === 0) { // Limit fire rate slightly
                    playerBullets.push({
                        x: player.x + player.width / 2 - 2.5,
                        y: player.y,
                        width: 5,
                        height: 20,
                        speed: 8,
                        color: '#00FF00'
                    });
                    try { audio.playerShoot.play(); } catch(e) {}
                }
            }
        }

        // Update invaders
        function updateInvaders() {
            invadersMoveTimer++;
            
            if (invadersMoveTimer >= invadersMoveInterval) {
                invadersMoveTimer = 0;
                
                // Check if need to descend
                let needsDescend = false;
                for (let invader of invaders) {
                    if (!invader.alive) continue;
                    
                    if ((invadersDirection > 0 && invader.x + invader.width >= 1200) ||
                        (invadersDirection < 0 && invader.x <= 0)) {
                        needsDescend = true;
                        break;
                    }
                }
                
                if (needsDescend) {
                    invadersDirection *= -1;
                    for (let invader of invaders) {
                        if (invader.alive) {
                            invader.y += 20;
                        }
                    }
                } else {
                    for (let invader of invaders) {
                        if (invader.alive) {
                            invader.x += 15 * invadersDirection;
                        }
                    }
                }
                
                // Check if invaders reached bottom
                for (let invader of invaders) {
                    if (invader.alive && invader.y + invader.height > 700) {
                        gameState = 'gameOver';
                        return;
                    }
                }
            }
            
            // Invader shooting
            invadersShootTimer++;
            if (invadersShootTimer >= invadersShootInterval) {
                invadersShootTimer = 0;
                
                // Random invader shoots
                if (Math.random() < 0.5) {
                    const aliveInvaders = invaders.filter(inv => inv.alive);
                    if (aliveInvaders.length > 0) {
                        const shooter = aliveInvaders[Math.floor(Math.random() * aliveInvaders.length)];
                        enemyBullets.push({
                            x: shooter.x + shooter.width / 2 - 2.5,
                            y: shooter.y + shooter.height,
                            width: 5,
                            height: 20,
                            speed: 3,
                            color: '#FFFF00'
                        });
                    }
                }
            }
            
            // Check if all invaders destroyed
            if (invaders.every(inv => !inv.alive)) {
                nextLevel();
            }
        }

        // Update bullets
        function updateBullets() {
            // Player bullets
            for (let i = playerBullets.length - 1; i >= 0; i--) {
                playerBullets[i].y -= playerBullets[i].speed;
                
                if (playerBullets[i].y < 0) {
                    playerBullets.splice(i, 1);
                }
            }
            
            // Enemy bullets
            for (let i = enemyBullets.length - 1; i >= 0; i--) {
                enemyBullets[i].y += enemyBullets[i].speed;
                
                if (enemyBullets[i].y > 800) {
                    enemyBullets.splice(i, 1);
                }
            }
        }

        // Collision detection
        function checkCollisions() {
            // Player bullets vs invaders
            for (let i = playerBullets.length - 1; i >= 0; i--) {
                const bullet = playerBullets[i];
                
                for (let invader of invaders) {
                    if (!invader.alive) continue;
                    
                    if (bullet.x < invader.x + invader.width &&
                        bullet.x + bullet.width > invader.x &&
                        bullet.y < invader.y + invader.height &&
                        bullet.y + bullet.height > invader.y) {
                        
                        invader.alive = false;
                        playerBullets.splice(i, 1);
                        score += 100;
                        try { audio.enemyDie.play(); } catch(e) {}
                        break;
                    }
                }
            }
            
            // Enemy bullets vs player
            for (let i = enemyBullets.length - 1; i >= 0; i--) {
                const bullet = enemyBullets[i];
                
                if (bullet.x < player.x + player.width &&
                    bullet.x + bullet.width > player.x &&
                    bullet.y < player.y + player.height &&
                    bullet.y + bullet.height > player.y) {
                    
                    enemyBullets.splice(i, 1);
                    lives--;
                    try { audio.playerDie.play(); } catch(e) {}
                    
                    if (lives <= 0) {
                        gameState = 'gameOver';
                    }
                }
            }
        }

        // Draw player (triangle)
        function drawPlayer() {
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.moveTo(player.x + player.width / 2, player.y);
            ctx.lineTo(player.x, player.y + player.height);
            ctx.lineTo(player.x + player.width, player.y + player.height);
            ctx.closePath();
            ctx.fill();
        }

        // Draw invaders
        function drawInvaders() {
            for (let invader of invaders) {
                if (invader.alive) {
                    ctx.fillStyle = invader.color;
                    ctx.fillRect(invader.x, invader.y, invader.width, invader.height);
                }
            }
        }

        // Draw bullets
        function drawBullets() {
            for (let bullet of playerBullets) {
                ctx.fillStyle = bullet.color;
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            }
            
            for (let bullet of enemyBullets) {
                ctx.fillStyle = bullet.color;
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            }
        }

        // Draw text centered
        function drawTextCentered(text, y, font, color) {
            ctx.font = font;
            ctx.fillStyle = color;
            ctx.textAlign = 'center';
            ctx.fillText(text, 600, y);
        }

        // Draw text aligned
        function drawText(text, x, y, font, color, align = 'left') {
            ctx.font = font;
            ctx.fillStyle = color;
            ctx.textAlign = align;
            ctx.fillText(text, x, y);
        }

        // Draw menu
        function drawMenu() {
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, 1200, 800);
            
            drawTextCentered('SPACE INVADERS', 300, 'bold 72px Arial', '#FF8000');
            drawTextCentered('AI-Generated Game', 350, '30px Arial', '#CCCCCC');
            drawTextCentered('Press SPACE to Start', 450, 'bold 40px Arial', '#00FF00');
            drawTextCentered('Controls: AD/Arrow Keys to move, SPACE to shoot', 550, '25px Arial', '#B3B3FF');
            drawTextCentered('Kill them all! You have 3 lives.', 600, '25px Arial', '#FFFF00');
        }

        // Draw game
        function drawGame() {
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, 1200, 800);
            
            // HUD
            drawText(`Lives: ${lives}`, 50, 50, 'bold 50px Arial', '#FFFF00', 'left');
            drawText(`Level: ${level}`, 1150, 50, 'bold 50px Arial', '#00FFFF', 'right');
            drawTextCentered('SPACE INVADERS', 50, 'bold 40px Arial', '#FF8000');
            drawTextCentered(`Score: ${score}`, 90, '30px Arial', '#FFFFFF');
            
            // Entities
            drawPlayer();
            drawInvaders();
            drawBullets();
        }

        // Draw game over
        function drawGameOver() {
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, 1200, 800);
            
            drawTextCentered('GAME OVER', 300, 'bold 80px Arial', '#FF0000');
            drawTextCentered(`Final Level: ${level}`, 400, '40px Arial', '#FFFF00');
            drawTextCentered(`Final Score: ${score}`, 450, '40px Arial', '#FFFF00');
            drawTextCentered('Press R to Restart', 550, '30px Arial', '#00FF00');
            
            // Achievement message
            let message = 'Good try! Practice makes perfect!';
            if (level >= 10) {
                message = "Amazing! You're an invaders master!";
            } else if (level >= 5) {
                message = "Great job! You're getting good at this!";
            }
            drawTextCentered(message, 650, '25px Arial', '#B3B3FF');
        }

        // Game loop
        function gameLoop() {
            frameCount++;
            
            if (gameState === 'menu') {
                drawMenu();
            } else if (gameState === 'playing') {
                updatePlayer();
                updateInvaders();
                updateBullets();
                checkCollisions();
                drawGame();
            } else if (gameState === 'gameOver') {
                drawGameOver();
            }
            
            requestAnimationFrame(gameLoop);
        }

        // Start game
        initInvaders();
        gameLoop();
    </script>
</body>
</html>
